<html>
	<!-- <meta http-equiv="refresh" content="5"></meta> -->
	<head>
		<title>Koalin - Collaboration interface</title>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
		<div id="image_header">
   			<img src="koalin.png"/>
		</div>
		
		<div id="main_content">
			<div id="two_tables">
				<table id="koalinfo_table"> 
				<thead>
				  <tr>
				    <th>Koalinfo</th>
				  </tr>
				  </thead>
				  <tbody id="koalinfo_table_body"></tbody>
				</table>
					<table id="koallaboration_table">
					<thead>
						<tr>
					    	<th>Koallaboration</th>
					  	</tr>
					</thead> 
				  	<tbody id="koallaboration_table_body"></tbody>
				</table>
			</div>
			<div id="bottom_form">
				<form action="process.php" method="POST" id="add_form">
					<div> Post a:
						<select name="type" id="koalin_type"></select>
					</div>
					<textarea name="text" id="text_to_add" cols="40" rows="5"></textarea>
					<button type="submit" id="add_koalin">Koalin</button>
				</form>
			</div>
		</div>
	
	</body>
</html>

<script>

var koalin_type = document.getElementById("koalin_type");
var option = document.createElement("option");
option.value = "koalinfo";
option.text = "Koalinfo";
koalin_type.add(option);
option = document.createElement("option");
option.value = "koallaboration";
option.text = "Koallaboration";
koalin_type.add(option);

var koalinfo_table = document.getElementById("koalinfo_table_body");
var koallaboration_table = document.getElementById("koallaboration_table_body");


readTextFile();
setInterval(readTextFile,10000);

function clearRows() {
	while (koalinfo_table.firstChild) {
		koalinfo_table.removeChild(koalinfo_table.firstChild);
	}
	while (koallaboration_table.firstChild) {
		koallaboration_table.removeChild(koallaboration_table.firstChild);
	}
}

function readTextFile()
{
	file = "./data/data.txt";
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
            	clearRows();
                var allText = rawFile.responseText;
                var lines = allText.split('\n');
                var row;
                
                for(var i = 0;i < lines.length;i++){
                	row = lines[i].split(',');
                	if(row.length==3) {
	                	if(row[1]=="koalinfo") {
	                		addRowKoalinfo(row[2]);
	                	} else {
	                		addRowKoallaboration(row[2]);	
	                	}
                	}
                }
            }
        }
    }
    rawFile.send(null);
}

function addRowKoallaboration(text) {
	if(text!="") {
		var row = koallaboration_table.insertRow(-1);
		var cell = row.insertCell();
		cell.innerHTML = text;
	} 
}

function addRowKoalinfo(text) {
	if(text!="") {
		var row = koalinfo_table.insertRow(-1);
		var cell = row.insertCell();
		cell.innerHTML = text;
	} 
}

</script>